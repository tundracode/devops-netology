# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"


1. Есть скрипт:
	```bash
	a=1
	b=2
	c=a+b
	d=$a+$b
	e=$(($a+$b))
	```
	* Какие значения переменным c,d,e будут присвоены?
	* Почему?

 - `c = a+b` - так как передали как текст без `$`, а не как переменные
 - `d = 1+3` - команда преобразовала вывела значения переменных, но не выполнила арифметической операции так как по умолчанию это строки 
 - `e = 3`   - интерпретатор воспринял выражение в скобках `((...))` как арифметическую операцию двух объявленных ранее переменных


2. На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
    ```bash
    while ((1==1)
    do
    curl https://localhost:4757
    if (($? != 0))
    then
    date >> curl.log
    fi
    done
    ```
  
- в условии пропущена одна закрывающая скобкая `)` 
- нужно добавить условие выход из цикла `else exit` 

```bash
while (( 1 == 1 ))
    do
        curl https://localhost:4757
        if (($? != 0))
        then
            date >> curl.log
        else exit
        fi
    done
```


3. Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.

```bash
#!/usr/bin/env bash

hosts=(192.168.0.1 173.194.222.113 87.250.250.24)

for i in {1..5}
do
    for h in ${hosts[@]}
    do
      nc -zw1  $h 80
      excode=$?
      echo $(date +"%b %d %T") "- check -" $h "- exite code:" $excode >>hosts.log
    done
done

```
```bash
vagrant@master:/vagrant$ cat hosts.log
Dec 15 20:27:00 - check - 192.168.0.1 - exite code: 0
Dec 15 20:27:00 - check - 173.194.222.113 - exite code: 0
Dec 15 20:27:01 - check - 87.250.250.24 - exite code: 1
Dec 15 20:27:01 - check - 192.168.0.1 - exite code: 0
Dec 15 20:27:01 - check - 173.194.222.113 - exite code: 0
Dec 15 20:27:02 - check - 87.250.250.24 - exite code: 1
Dec 15 20:27:02 - check - 192.168.0.1 - exite code: 0
Dec 15 20:27:02 - check - 173.194.222.113 - exite code: 0
Dec 15 20:27:03 - check - 87.250.250.24 - exite code: 1
Dec 15 20:27:03 - check - 192.168.0.1 - exite code: 0
Dec 15 20:27:03 - check - 173.194.222.113 - exite code: 0
Dec 15 20:27:04 - check - 87.250.250.24 - exite code: 1
Dec 15 20:27:04 - check - 192.168.0.1 - exite code: 0
Dec 15 20:27:04 - check - 173.194.222.113 - exite code: 0
Dec 15 20:27:05 - check - 87.250.250.24 - exite code: 1
```
4. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается

```bash
#!/usr/bin/env bash

hosts=(192.168.0.1 173.194.222.113 87.250.250.24)

for i in {1..5}
do
    for h in ${hosts[@]}
    do
      nc -zw1  $h 80
      if [ "$?" -eq  0 ]
      then
            excode=$?
            echo $(date +"%b %d %T") "- ok -" $h "- exit code:" $excode >> hosts.log
      else
            excode=$?
            echo $(date +"%b %d %T") "- failure -" $h "- exit code:" $excode >> error.log
            exit
      fi
    done
done
```

```bash
vagrant@master:/vagrant$ cat hosts.log error.log
Dec 15 20:16:00 - ok - 192.168.0.1 - exit code: 0
Dec 15 20:16:00 - ok - 173.194.222.113 - exit code: 0
Dec 15 20:16:01 - failure - 87.250.250.24 - exit code: 1
```